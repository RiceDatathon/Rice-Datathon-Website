{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = connect;\n\nvar _client = require(\"@next/react-dev-overlay/lib/client\");\n\nvar _stripAnsi = _interopRequireDefault(require(\"next/dist/compiled/strip-ansi\"));\n\nvar _eventsource = require(\"./eventsource\");\n\nvar _formatWebpackMessages = _interopRequireDefault(require(\"./format-webpack-messages\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n} // This alternative WebpackDevServer combines the functionality of:\n// https://github.com/webpack/webpack-dev-server/blob/webpack-1/client/index.js\n// https://github.com/webpack/webpack/blob/webpack-1/hot/dev-server.js\n// It only supports their simplest configuration (hot updates on same server).\n// It makes some opinionated choices on top, like adding a syntax error overlay\n// that looks similar to our console output. The error overlay is inspired by:\n// https://github.com/glenjamin/webpack-hot-middleware\n\n\nvar hadRuntimeError = false;\nvar customHmrEventHandler;\n\nfunction connect() {\n  (0, _client).register();\n  (0, _eventsource).addMessageListener(function (event) {\n    // This is the heartbeat event\n    if (event.data === \"\\uD83D\\uDC93\") {\n      return;\n    }\n\n    try {\n      processMessage(event);\n    } catch (ex) {\n      console.warn('Invalid HMR message: ' + event.data + '\\n' + ex);\n    }\n  });\n  return {\n    subscribeToHmrEvent: function subscribeToHmrEvent(handler) {\n      customHmrEventHandler = handler;\n    },\n    onUnrecoverableError: function onUnrecoverableError() {\n      hadRuntimeError = true;\n    }\n  };\n} // Remember some state related to hot module replacement.\n\n\nvar isFirstCompilation = true;\nvar mostRecentCompilationHash = null;\nvar hasCompileErrors = false;\n\nfunction clearOutdatedErrors() {\n  // Clean up outdated compile errors, if any.\n  if (typeof console !== 'undefined' && typeof console.clear === 'function') {\n    if (hasCompileErrors) {\n      console.clear();\n    }\n  }\n} // Successful compilation.\n\n\nfunction handleSuccess() {\n  clearOutdatedErrors();\n  var isHotUpdate = !isFirstCompilation;\n  isFirstCompilation = false;\n  hasCompileErrors = false; // Attempt to apply hot updates or reload.\n\n  if (isHotUpdate) {\n    tryApplyUpdates(function onSuccessfulHotUpdate(hasUpdates) {\n      // Only dismiss it when we're sure it's a hot update.\n      // Otherwise it would flicker right before the reload.\n      onFastRefresh(hasUpdates);\n    });\n  }\n} // Compilation with warnings (e.g. ESLint).\n\n\nfunction handleWarnings(warnings) {\n  clearOutdatedErrors();\n  var isHotUpdate = !isFirstCompilation;\n  isFirstCompilation = false;\n  hasCompileErrors = false;\n\n  function printWarnings() {\n    // Print warnings to the console.\n    var formatted = (0, _formatWebpackMessages)[\"default\"]({\n      warnings: warnings,\n      errors: []\n    });\n\n    if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n      for (var i = 0; i < formatted.warnings.length; i++) {\n        if (i === 5) {\n          console.warn('There were more warnings in other files.\\n' + 'You can find a complete log in the terminal.');\n          break;\n        }\n\n        console.warn((0, _stripAnsi)[\"default\"](formatted.warnings[i]));\n      }\n    }\n  }\n\n  printWarnings(); // Attempt to apply hot updates or reload.\n\n  if (isHotUpdate) {\n    tryApplyUpdates(function onSuccessfulHotUpdate(hasUpdates) {\n      // Only dismiss it when we're sure it's a hot update.\n      // Otherwise it would flicker right before the reload.\n      onFastRefresh(hasUpdates);\n    });\n  }\n} // Compilation with errors (e.g. syntax error or missing modules).\n\n\nfunction handleErrors(errors) {\n  clearOutdatedErrors();\n  isFirstCompilation = false;\n  hasCompileErrors = true; // \"Massage\" webpack messages.\n\n  var formatted = (0, _formatWebpackMessages)[\"default\"]({\n    errors: errors,\n    warnings: []\n  }); // Only show the first error.\n\n  (0, _client).onBuildError(formatted.errors[0]); // Also log them to the console.\n\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    for (var i = 0; i < formatted.errors.length; i++) {\n      console.error((0, _stripAnsi)[\"default\"](formatted.errors[i]));\n    }\n  } // Do not attempt to reload now.\n  // We will reload on next success instead.\n\n\n  if (process.env.__NEXT_TEST_MODE) {\n    if (self.__NEXT_HMR_CB) {\n      self.__NEXT_HMR_CB(formatted.errors[0]);\n\n      self.__NEXT_HMR_CB = null;\n    }\n  }\n}\n\nvar startLatency = undefined;\n\nfunction onFastRefresh(hasUpdates) {\n  (0, _client).onBuildOk();\n\n  if (hasUpdates) {\n    (0, _client).onRefresh();\n  }\n\n  if (startLatency) {\n    var latency = Date.now() - startLatency;\n    console.log(\"[Fast Refresh] done in \".concat(latency, \"ms\"));\n\n    if (self.__NEXT_HMR_LATENCY_CB) {\n      self.__NEXT_HMR_LATENCY_CB(latency);\n    }\n  }\n} // There is a newer version of the code available.\n\n\nfunction handleAvailableHash(hash) {\n  // Update last known compilation hash.\n  mostRecentCompilationHash = hash;\n} // Handle messages from the server.\n\n\nfunction processMessage(e) {\n  var obj = JSON.parse(e.data);\n\n  switch (obj.action) {\n    case 'building':\n      {\n        startLatency = Date.now();\n        console.log('[Fast Refresh] rebuilding');\n        break;\n      }\n\n    case 'built':\n    case 'sync':\n      {\n        if (obj.hash) {\n          handleAvailableHash(obj.hash);\n        }\n\n        var errors = obj.errors,\n            warnings = obj.warnings;\n        var hasErrors = Boolean(errors && errors.length);\n\n        if (hasErrors) {\n          return handleErrors(errors);\n        }\n\n        var hasWarnings = Boolean(warnings && warnings.length);\n\n        if (hasWarnings) {\n          return handleWarnings(warnings);\n        }\n\n        return handleSuccess();\n      }\n\n    default:\n      {\n        if (customHmrEventHandler) {\n          customHmrEventHandler(obj);\n          break;\n        }\n\n        break;\n      }\n  }\n} // Is there a newer version of this code available?\n\n\nfunction isUpdateAvailable() {\n  /* globals __webpack_hash__ */\n  // __webpack_hash__ is the hash of the current compilation.\n  // It's a global variable injected by Webpack.\n  return mostRecentCompilationHash !== __webpack_hash__;\n} // Webpack disallows updates in other states.\n\n\nfunction canApplyUpdates() {\n  return module.hot.status() === 'idle';\n}\n\nfunction afterApplyUpdates(fn) {\n  if (canApplyUpdates()) {\n    fn();\n  } else {\n    var handler = function handler(status) {\n      if (status === 'idle') {\n        module.hot.removeStatusHandler(handler);\n        fn();\n      }\n    };\n\n    module.hot.addStatusHandler(handler);\n  }\n} // Attempt to update code on the fly, fall back to a hard reload.\n\n\nfunction tryApplyUpdates(onHotUpdateSuccess) {\n  if (!module.hot) {\n    // HotModuleReplacementPlugin is not in Webpack configuration.\n    console.error('HotModuleReplacementPlugin is not in Webpack configuration.'); // window.location.reload();\n\n    return;\n  }\n\n  if (!isUpdateAvailable() || !canApplyUpdates()) {\n    return;\n  }\n\n  function handleApplyUpdates(err, updatedModules) {\n    if (err || hadRuntimeError || !updatedModules) {\n      if (err) {\n        console.warn('[Fast Refresh] performing full reload\\n\\n' + \"Fast Refresh will perform a full reload when you edit a file that's imported by modules outside of the React rendering tree.\\n\" + 'You might have a file which exports a React component but also exports a value that is imported by a non-React component file.\\n' + 'Consider migrating the non-React component export to a separate file and importing it into both files.\\n\\n' + 'It is also possible the parent component of the component you edited is a class component, which disables Fast Refresh.\\n' + 'Fast Refresh requires at least one parent function component in your React tree.');\n      } else if (hadRuntimeError) {\n        console.warn('[Fast Refresh] performing full reload because your application had an unrecoverable error');\n      }\n\n      window.location.reload();\n      return;\n    }\n\n    var hasUpdates = Boolean(updatedModules.length);\n\n    if (typeof onHotUpdateSuccess === 'function') {\n      // Maybe we want to do something.\n      onHotUpdateSuccess(hasUpdates);\n    }\n\n    if (isUpdateAvailable()) {\n      // While we were updating, there was a new update! Do it again.\n      tryApplyUpdates(hasUpdates ? undefined : onHotUpdateSuccess);\n    } else {\n      if (process.env.__NEXT_TEST_MODE) {\n        afterApplyUpdates(function () {\n          if (self.__NEXT_HMR_CB) {\n            self.__NEXT_HMR_CB();\n\n            self.__NEXT_HMR_CB = null;\n          }\n        });\n      }\n    }\n  } // https://webpack.js.org/api/hot-module-replacement/#check\n\n\n  module.hot.check(\n  /* autoApply */\n  true).then(function (updatedModules) {\n    handleApplyUpdates(null, updatedModules);\n  }, function (err) {\n    handleApplyUpdates(err, null);\n  });\n}","map":{"version":3,"sources":["../../../../client/dev/error-overlay/hot-dev-client.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * MIT License\n *\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n// This file is a modified version of the Create React App HMR dev client that\n// can be found here:\n// https://github.com/facebook/create-react-app/blob/v3.4.1/packages/react-dev-utils/webpackHotDevClient.js\n\nimport {\n  register,\n  onBuildError,\n  onBuildOk,\n  onRefresh,\n} from '@next/react-dev-overlay/lib/client'\nimport stripAnsi from 'next/dist/compiled/strip-ansi'\nimport { addMessageListener } from './eventsource'\nimport formatWebpackMessages from './format-webpack-messages'\n\n// This alternative WebpackDevServer combines the functionality of:\n// https://github.com/webpack/webpack-dev-server/blob/webpack-1/client/index.js\n// https://github.com/webpack/webpack/blob/webpack-1/hot/dev-server.js\n\n// It only supports their simplest configuration (hot updates on same server).\n// It makes some opinionated choices on top, like adding a syntax error overlay\n// that looks similar to our console output. The error overlay is inspired by:\n// https://github.com/glenjamin/webpack-hot-middleware\n\nlet hadRuntimeError = false\nlet customHmrEventHandler\nexport default function connect() {\n  register()\n\n  addMessageListener((event) => {\n    // This is the heartbeat event\n    if (event.data === '\\uD83D\\uDC93') {\n      return\n    }\n    try {\n      processMessage(event)\n    } catch (ex) {\n      console.warn('Invalid HMR message: ' + event.data + '\\n' + ex)\n    }\n  })\n\n  return {\n    subscribeToHmrEvent(handler) {\n      customHmrEventHandler = handler\n    },\n    onUnrecoverableError() {\n      hadRuntimeError = true\n    },\n  }\n}\n\n// Remember some state related to hot module replacement.\nvar isFirstCompilation = true\nvar mostRecentCompilationHash = null\nvar hasCompileErrors = false\n\nfunction clearOutdatedErrors() {\n  // Clean up outdated compile errors, if any.\n  if (typeof console !== 'undefined' && typeof console.clear === 'function') {\n    if (hasCompileErrors) {\n      console.clear()\n    }\n  }\n}\n\n// Successful compilation.\nfunction handleSuccess() {\n  clearOutdatedErrors()\n\n  const isHotUpdate = !isFirstCompilation\n  isFirstCompilation = false\n  hasCompileErrors = false\n\n  // Attempt to apply hot updates or reload.\n  if (isHotUpdate) {\n    tryApplyUpdates(function onSuccessfulHotUpdate(hasUpdates) {\n      // Only dismiss it when we're sure it's a hot update.\n      // Otherwise it would flicker right before the reload.\n      onFastRefresh(hasUpdates)\n    })\n  }\n}\n\n// Compilation with warnings (e.g. ESLint).\nfunction handleWarnings(warnings) {\n  clearOutdatedErrors()\n\n  const isHotUpdate = !isFirstCompilation\n  isFirstCompilation = false\n  hasCompileErrors = false\n\n  function printWarnings() {\n    // Print warnings to the console.\n    const formatted = formatWebpackMessages({\n      warnings: warnings,\n      errors: [],\n    })\n\n    if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n      for (let i = 0; i < formatted.warnings.length; i++) {\n        if (i === 5) {\n          console.warn(\n            'There were more warnings in other files.\\n' +\n              'You can find a complete log in the terminal.'\n          )\n          break\n        }\n        console.warn(stripAnsi(formatted.warnings[i]))\n      }\n    }\n  }\n\n  printWarnings()\n\n  // Attempt to apply hot updates or reload.\n  if (isHotUpdate) {\n    tryApplyUpdates(function onSuccessfulHotUpdate(hasUpdates) {\n      // Only dismiss it when we're sure it's a hot update.\n      // Otherwise it would flicker right before the reload.\n      onFastRefresh(hasUpdates)\n    })\n  }\n}\n\n// Compilation with errors (e.g. syntax error or missing modules).\nfunction handleErrors(errors) {\n  clearOutdatedErrors()\n\n  isFirstCompilation = false\n  hasCompileErrors = true\n\n  // \"Massage\" webpack messages.\n  var formatted = formatWebpackMessages({\n    errors: errors,\n    warnings: [],\n  })\n\n  // Only show the first error.\n  onBuildError(formatted.errors[0])\n\n  // Also log them to the console.\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    for (var i = 0; i < formatted.errors.length; i++) {\n      console.error(stripAnsi(formatted.errors[i]))\n    }\n  }\n\n  // Do not attempt to reload now.\n  // We will reload on next success instead.\n  if (process.env.__NEXT_TEST_MODE) {\n    if (self.__NEXT_HMR_CB) {\n      self.__NEXT_HMR_CB(formatted.errors[0])\n      self.__NEXT_HMR_CB = null\n    }\n  }\n}\n\nlet startLatency = undefined\n\nfunction onFastRefresh(hasUpdates) {\n  onBuildOk()\n  if (hasUpdates) {\n    onRefresh()\n  }\n\n  if (startLatency) {\n    const latency = Date.now() - startLatency\n    console.log(`[Fast Refresh] done in ${latency}ms`)\n    if (self.__NEXT_HMR_LATENCY_CB) {\n      self.__NEXT_HMR_LATENCY_CB(latency)\n    }\n  }\n}\n\n// There is a newer version of the code available.\nfunction handleAvailableHash(hash) {\n  // Update last known compilation hash.\n  mostRecentCompilationHash = hash\n}\n\n// Handle messages from the server.\nfunction processMessage(e) {\n  const obj = JSON.parse(e.data)\n  switch (obj.action) {\n    case 'building': {\n      startLatency = Date.now()\n      console.log('[Fast Refresh] rebuilding')\n      break\n    }\n    case 'built':\n    case 'sync': {\n      if (obj.hash) {\n        handleAvailableHash(obj.hash)\n      }\n\n      const { errors, warnings } = obj\n      const hasErrors = Boolean(errors && errors.length)\n      if (hasErrors) {\n        return handleErrors(errors)\n      }\n\n      const hasWarnings = Boolean(warnings && warnings.length)\n      if (hasWarnings) {\n        return handleWarnings(warnings)\n      }\n\n      return handleSuccess()\n    }\n    default: {\n      if (customHmrEventHandler) {\n        customHmrEventHandler(obj)\n        break\n      }\n      break\n    }\n  }\n}\n\n// Is there a newer version of this code available?\nfunction isUpdateAvailable() {\n  /* globals __webpack_hash__ */\n  // __webpack_hash__ is the hash of the current compilation.\n  // It's a global variable injected by Webpack.\n  return mostRecentCompilationHash !== __webpack_hash__\n}\n\n// Webpack disallows updates in other states.\nfunction canApplyUpdates() {\n  return module.hot.status() === 'idle'\n}\nfunction afterApplyUpdates(fn) {\n  if (canApplyUpdates()) {\n    fn()\n  } else {\n    function handler(status) {\n      if (status === 'idle') {\n        module.hot.removeStatusHandler(handler)\n        fn()\n      }\n    }\n    module.hot.addStatusHandler(handler)\n  }\n}\n\n// Attempt to update code on the fly, fall back to a hard reload.\nfunction tryApplyUpdates(onHotUpdateSuccess) {\n  if (!module.hot) {\n    // HotModuleReplacementPlugin is not in Webpack configuration.\n    console.error('HotModuleReplacementPlugin is not in Webpack configuration.')\n    // window.location.reload();\n    return\n  }\n\n  if (!isUpdateAvailable() || !canApplyUpdates()) {\n    return\n  }\n\n  function handleApplyUpdates(err, updatedModules) {\n    if (err || hadRuntimeError || !updatedModules) {\n      if (err) {\n        console.warn(\n          '[Fast Refresh] performing full reload\\n\\n' +\n            \"Fast Refresh will perform a full reload when you edit a file that's imported by modules outside of the React rendering tree.\\n\" +\n            'You might have a file which exports a React component but also exports a value that is imported by a non-React component file.\\n' +\n            'Consider migrating the non-React component export to a separate file and importing it into both files.\\n\\n' +\n            'It is also possible the parent component of the component you edited is a class component, which disables Fast Refresh.\\n' +\n            'Fast Refresh requires at least one parent function component in your React tree.'\n        )\n      } else if (hadRuntimeError) {\n        console.warn(\n          '[Fast Refresh] performing full reload because your application had an unrecoverable error'\n        )\n      }\n      window.location.reload()\n      return\n    }\n\n    const hasUpdates = Boolean(updatedModules.length)\n    if (typeof onHotUpdateSuccess === 'function') {\n      // Maybe we want to do something.\n      onHotUpdateSuccess(hasUpdates)\n    }\n\n    if (isUpdateAvailable()) {\n      // While we were updating, there was a new update! Do it again.\n      tryApplyUpdates(hasUpdates ? undefined : onHotUpdateSuccess)\n    } else {\n      if (process.env.__NEXT_TEST_MODE) {\n        afterApplyUpdates(() => {\n          if (self.__NEXT_HMR_CB) {\n            self.__NEXT_HMR_CB()\n            self.__NEXT_HMR_CB = null\n          }\n        })\n      }\n    }\n  }\n\n  // https://webpack.js.org/api/hot-module-replacement/#check\n  module.hot.check(/* autoApply */ true).then(\n    (updatedModules) => {\n      handleApplyUpdates(null, updatedModules)\n    },\n    (err) => {\n      handleApplyUpdates(err, null)\n    }\n  )\n}\n"]},"metadata":{},"sourceType":"script"}